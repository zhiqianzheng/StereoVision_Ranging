#!/usr/bin/env python3
"""
双目摄像头标定配置文件
自动生成时间: 2025-09-11 09:53:24
摄像头型号: HBVCAM-W2307-2
基线距离: 119.14 mm
焦距: 611.40 像素
使用图像对: 21 对
"""

import numpy as np

# 基本标定参数
CHESSBOARD_SIZE = (11, 8)
SQUARE_SIZE_MM = 40.0
BASELINE_MM = 119.1421979853503
FOCAL_LENGTH = 611.401835030741

# 左摄像头参数
LEFT_CAMERA_MATRIX = np.array([[722.3526950774478, 0.0, 617.7691754016028], [0.0, 722.3526950774478, 390.89900445624244], [0.0, 0.0, 1.0]])
LEFT_DIST_COEFFS = np.array([[0.12686717941228404, -0.21301389385620748, 0.0005515480468050966, 0.0008268777539925013, 0.0631095893520613]])

# 右摄像头参数  
RIGHT_CAMERA_MATRIX = np.array([[723.5610828026955, 0.0, 617.809893987072], [0.0, 723.5610828026955, 318.66989568768105], [0.0, 0.0, 1.0]])
RIGHT_DIST_COEFFS = np.array([[0.14360065355071705, -0.22021113874108952, 0.0010282452980501836, -0.00030107834651153163, 0.05518941150092616]])

# 双目关系参数
ROTATION_MATRIX = np.array([[0.998851767951178, 0.008093960516395738, 0.047218994736917916], [-0.00718135559240186, 0.9997847515627598, -0.01946480604696651], [-0.047366378293696186, 0.019103359540917728, 0.9986948922777111]])
TRANSLATION_VECTOR = np.array([[-119.1123429564877], [-0.23187608416329292], [2.6569399086270145]])
ESSENTIAL_MATRIX = np.array([[0.030063560591233763, -2.660797618668553, -0.17985664089536754], [-2.98803117085334, 2.2969510799737467, 119.08234654943703], [1.0869979268267624, -119.08482741494038, 2.3294476090455145]])
FUNDAMENTAL_MATRIX = np.array([[4.889381550637964e-09, -4.3273832276849266e-07, 0.000145006966966636], [-4.859578902893324e-07, 3.735642090383778e-07, 0.014143941725787002], [0.0002797532504928686, -0.013865146153833767, 1.0]])

# 立体矫正参数
RECTIFY_R1 = np.array([[0.9996437936938277, 0.009611710335346918, 0.02489780620539915], [-0.009369467881797041, 0.9999078082216198, -0.009827925978984459], [-0.02498997401007454, 0.009591146014205453, 0.9996416913660164]])
RECTIFY_R2 = np.array([[0.9997494168366253, 0.001946212912682371, -0.022300578246453293], [-0.001729560023790051, 0.9999511637821116, 0.009730296651432258], [0.022318426399542256, -0.0096892882142743, 0.9997039589483223]])
RECTIFY_P1 = np.array([[611.401835030741, 0.0, 608.861701965332, 0.0], [0.0, 611.401835030741, 354.9742317199707, 0.0], [0.0, 0.0, 1.0, 0.0]])
RECTIFY_P2 = np.array([[611.401835030741, 0.0, 608.861701965332, -72843.75847783902], [0.0, 611.401835030741, 354.9742317199707, 0.0], [0.0, 0.0, 1.0, 0.0]])
RECTIFY_Q = np.array([[1.0, 0.0, 0.0, -608.861701965332], [0.0, 1.0, 0.0, -354.9742317199707], [0.0, 0.0, 0.0, 611.401835030741], [0.0, 0.0, 0.008393331807786187, -0.0]])

# ROI区域
ROI_LEFT = (114, 28, 1086, 591)
ROI_RIGHT = (69, 101, 1075, 587)

def get_distance_from_disparity(disparity):
    """
    根据视差计算距离
    
    参数:
        disparity: 视差值（像素）
        
    返回:
        distance: 距离（毫米）
    """
    if disparity <= 0:
        return float('inf')
    
    return (FOCAL_LENGTH * BASELINE_MM) / disparity

def get_max_distance():
    """获取最大有效测距距离（以1像素视差为基准）"""
    return get_distance_from_disparity(1.0)

def get_recommended_max_distance():
    """获取推荐最大测距距离（以10像素视差为基准）"""
    return get_distance_from_disparity(10.0)

# 摄像头配置
CAMERA_INDEX = 20  # HBVCAM-W2307-2摄像头索引
CAMERA_WIDTH = 2560
CAMERA_HEIGHT = 720
CAMERA_FPS = 30

# 测距配置
MIN_DISPARITY = 1    # 最小视差（像素）
MAX_DISPARITY = 128  # 最大视差（像素）
DISPARITY_SEARCH_RANGE = 64  # 视差搜索范围

# 距离测量精度配置
DISTANCE_FILTER_WINDOW = 5  # 距离滤波窗口大小
MIN_VALID_DISTANCE_MM = 500   # 最小有效距离（毫米）
MAX_VALID_DISTANCE_MM = 6000  # 最大有效距离（毫米）

print(f"摄像头配置已加载:")
print(f"  基线距离: {BASELINE_MM:.1f} mm")
print(f"  焦距: {FOCAL_LENGTH:.1f} 像素")
print(f"  最大理论测距: {get_max_distance()/1000:.1f} 米")
print(f"  推荐最大测距: {get_recommended_max_distance()/1000:.1f} 米")
